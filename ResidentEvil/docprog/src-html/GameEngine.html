<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="fr">
<head>
<title>Source code</title>
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
</head>
<body>
<div class="sourceContainer">
<pre><span class="sourceLineNo">001</span><a name="line.1">import java.util.ArrayList;</a>
<span class="sourceLineNo">002</span><a name="line.2">import java.util.HashMap;</a>
<span class="sourceLineNo">003</span><a name="line.3">import java.util.Random;</a>
<span class="sourceLineNo">004</span><a name="line.4">import java.util.Stack;</a>
<span class="sourceLineNo">005</span><a name="line.5"></a>
<span class="sourceLineNo">006</span><a name="line.6">/**</a>
<span class="sourceLineNo">007</span><a name="line.7"> * Game est la classe principale du jeu, elle permet de creer</a>
<span class="sourceLineNo">008</span><a name="line.8"> * l'environnement du jeu, permet de le lancer, et d'executer</a>
<span class="sourceLineNo">009</span><a name="line.9"> * les commandes. Elle fait communiquer l'ensemble des classes</a>
<span class="sourceLineNo">010</span><a name="line.10"> * entre elles.</a>
<span class="sourceLineNo">011</span><a name="line.11"> */</a>
<span class="sourceLineNo">012</span><a name="line.12">public class GameEngine {</a>
<span class="sourceLineNo">013</span><a name="line.13">    private Parser parser;</a>
<span class="sourceLineNo">014</span><a name="line.14">    private Room currentRoom;</a>
<span class="sourceLineNo">015</span><a name="line.15">    private UserInterface gui;</a>
<span class="sourceLineNo">016</span><a name="line.16">    </a>
<span class="sourceLineNo">017</span><a name="line.17">    private HashMap&lt;String, Room&gt; rooms = new HashMap&lt;String, Room&gt;();</a>
<span class="sourceLineNo">018</span><a name="line.18">    private Player player;</a>
<span class="sourceLineNo">019</span><a name="line.19">    </a>
<span class="sourceLineNo">020</span><a name="line.20">    private Item ammo = new Item("Ammo", "Munitions for a simple gun", 7);</a>
<span class="sourceLineNo">021</span><a name="line.21">    private HealItem herb = new HealItem("Herb", "An healing item that restore 1 health when used", 1, 1);</a>
<span class="sourceLineNo">022</span><a name="line.22">    private HealItem spray = new HealItem("Spray", "An healing item that restore all health when used", 1, 2);</a>
<span class="sourceLineNo">023</span><a name="line.23">    private KeyItem medal = new KeyItem("Medal", "A medal that should be used somewhere ..", 1);</a>
<span class="sourceLineNo">024</span><a name="line.24">    private Weapon matilda = new Weapon("Matilda", 1, 8, 12);</a>
<span class="sourceLineNo">025</span><a name="line.25"></a>
<span class="sourceLineNo">026</span><a name="line.26">    private Stack&lt;Room&gt; roadHistory = new Stack&lt;Room&gt;();</a>
<span class="sourceLineNo">027</span><a name="line.27">    </a>
<span class="sourceLineNo">028</span><a name="line.28">    /**</a>
<span class="sourceLineNo">029</span><a name="line.29">     * Create the game and initialize its internal map.</a>
<span class="sourceLineNo">030</span><a name="line.30">     */</a>
<span class="sourceLineNo">031</span><a name="line.31">    public GameEngine() {</a>
<span class="sourceLineNo">032</span><a name="line.32">        createRooms();</a>
<span class="sourceLineNo">033</span><a name="line.33">        parser = new Parser();</a>
<span class="sourceLineNo">034</span><a name="line.34">        player = new Player(3);</a>
<span class="sourceLineNo">035</span><a name="line.35">        player.setGun(matilda);</a>
<span class="sourceLineNo">036</span><a name="line.36">    }</a>
<span class="sourceLineNo">037</span><a name="line.37"></a>
<span class="sourceLineNo">038</span><a name="line.38">    public void setGUI(UserInterface userInterface)</a>
<span class="sourceLineNo">039</span><a name="line.39">    {</a>
<span class="sourceLineNo">040</span><a name="line.40">        gui = userInterface;</a>
<span class="sourceLineNo">041</span><a name="line.41">        printWelcome();</a>
<span class="sourceLineNo">042</span><a name="line.42">        </a>
<span class="sourceLineNo">043</span><a name="line.43">    }</a>
<span class="sourceLineNo">044</span><a name="line.44">    </a>
<span class="sourceLineNo">045</span><a name="line.45">    /**</a>
<span class="sourceLineNo">046</span><a name="line.46">     * Create all the rooms and link their exits together.</a>
<span class="sourceLineNo">047</span><a name="line.47">     */</a>
<span class="sourceLineNo">048</span><a name="line.48">    private void createRooms() {</a>
<span class="sourceLineNo">049</span><a name="line.49">        Room outside, station_hall, station_1st_floor, west_wing, armory, west_stairs, black_room, west_corridor, squad_office, reserve, library, east_wing, bathroom, police_office, back_garden, east_corridor, chief_office, break_room, roof, backyard_room, undergrounds;</a>
<span class="sourceLineNo">050</span><a name="line.50">        </a>
<span class="sourceLineNo">051</span><a name="line.51">        // create the rooms</a>
<span class="sourceLineNo">052</span><a name="line.52">        // start</a>
<span class="sourceLineNo">053</span><a name="line.53">        outside = new Room("in the streets of Fock City. You can see the police station from here. Zombies are all around you so you should hurry", "outside.jpg");</a>
<span class="sourceLineNo">054</span><a name="line.54">        </a>
<span class="sourceLineNo">055</span><a name="line.55">        // Police Station rooms</a>
<span class="sourceLineNo">056</span><a name="line.56">        // Center</a>
<span class="sourceLineNo">057</span><a name="line.57">        station_hall = new Room("in the main hall of the police station. This place is huge. You remember there's a secret passage under the big statue here, but you need two medaillons first ..", "station_hall.jpg");</a>
<span class="sourceLineNo">058</span><a name="line.58">        station_1st_floor = new Room("above the police station hall", "outside.jpg");</a>
<span class="sourceLineNo">059</span><a name="line.59">        </a>
<span class="sourceLineNo">060</span><a name="line.60">        //West side</a>
<span class="sourceLineNo">061</span><a name="line.61">        west_wing = new Room("in the west wing. The corridor is tight and only the moonlight brighten a bit this place..", "west_wing.jpg");</a>
<span class="sourceLineNo">062</span><a name="line.62">        armory = new Room("in the armory. There's many weapons exposed here, but you need a keycard first", "outside.jpg");</a>
<span class="sourceLineNo">063</span><a name="line.63">        west_stairs = new Room("in the front of the stairs. You can see a small room hide behind those", "outside.jpg");</a>
<span class="sourceLineNo">064</span><a name="line.64">        black_room = new Room("in what looks like a black room. It looks safe but there's not much to see here", "outside.jpg");</a>
<span class="sourceLineNo">065</span><a name="line.65">        west_corridor = new Room("in the corridor upstairs. A fading light is somehow lightening it", "outside.jpg");</a>
<span class="sourceLineNo">066</span><a name="line.66">        squad_office = new Room("in the office of the squad unity. There should be something useful", "outside.jpg");</a>
<span class="sourceLineNo">067</span><a name="line.67">        reserve = new Room("in the reserve. It's really dark in here", "outside.jpg");</a>
<span class="sourceLineNo">068</span><a name="line.68">        library = new Room("in the library. It's quite big and almost too bright. It's also full of zombies", "outside.jpg");</a>
<span class="sourceLineNo">069</span><a name="line.69">        </a>
<span class="sourceLineNo">070</span><a name="line.70">        //East side</a>
<span class="sourceLineNo">071</span><a name="line.71">        east_wing = new Room("in the east wing. The path looks long, and the weak moonlight shows you blood along the way", "outside.jpg");</a>
<span class="sourceLineNo">072</span><a name="line.72">        bathroom = new Room("in the bathroom. The water is flowing from one of the sink", "outside.jpg");</a>
<span class="sourceLineNo">073</span><a name="line.73">        police_office = new Room("in the main police office. The desks are messy", "outside.jpg");</a>
<span class="sourceLineNo">074</span><a name="line.74">        back_garden = new Room("in a small garden, which serves as a fire exit. There's an access to upstairs", "outside.jpg");</a>
<span class="sourceLineNo">075</span><a name="line.75">        east_corridor = new Room("in the corridor upstairs. It's the cleanest room you've seen yet", "outside.jpg");</a>
<span class="sourceLineNo">076</span><a name="line.76">        chief_office = new Room("in the office of the police chief. It's quite small but it has to contain some ammo. Looks like you can unlock to access to the main hall from here", "outside.jpg");</a>
<span class="sourceLineNo">077</span><a name="line.77">        break_room = new Room("in the break room. Not much useful things here but it's a safe place", "outside.jpg");</a>
<span class="sourceLineNo">078</span><a name="line.78">        roof = new Room("in the roof of the station. It's pouring rain here. There's a small building downstairs", "outside.jpg");</a>
<span class="sourceLineNo">079</span><a name="line.79">        backyard_room = new Room("in the backyard room. There might be something useful ..", "outside.jpg");</a>
<span class="sourceLineNo">080</span><a name="line.80">        </a>
<span class="sourceLineNo">081</span><a name="line.81">        //others</a>
<span class="sourceLineNo">082</span><a name="line.82">        undergrounds = new Room("in the undergrounds of the station. You escaped!", "outside.jpg");</a>
<span class="sourceLineNo">083</span><a name="line.83">        </a>
<span class="sourceLineNo">084</span><a name="line.84">        //Add all the rooms in 'rooms'</a>
<span class="sourceLineNo">085</span><a name="line.85">        rooms.put("outside", outside);</a>
<span class="sourceLineNo">086</span><a name="line.86">        rooms.put("station hall", station_hall);</a>
<span class="sourceLineNo">087</span><a name="line.87">        rooms.put("station 1st floor", station_1st_floor);</a>
<span class="sourceLineNo">088</span><a name="line.88">        rooms.put("west wing", west_wing);</a>
<span class="sourceLineNo">089</span><a name="line.89">        rooms.put("armory", armory);</a>
<span class="sourceLineNo">090</span><a name="line.90">        rooms.put("west stairs", west_stairs);</a>
<span class="sourceLineNo">091</span><a name="line.91">        rooms.put("black room", black_room);</a>
<span class="sourceLineNo">092</span><a name="line.92">        rooms.put("west corridor", west_corridor);</a>
<span class="sourceLineNo">093</span><a name="line.93">        rooms.put("squad office", squad_office);</a>
<span class="sourceLineNo">094</span><a name="line.94">        rooms.put("reserve", reserve);</a>
<span class="sourceLineNo">095</span><a name="line.95">        rooms.put("library", library);</a>
<span class="sourceLineNo">096</span><a name="line.96">        rooms.put("east wing", east_wing);</a>
<span class="sourceLineNo">097</span><a name="line.97">        rooms.put("bathroom", bathroom);</a>
<span class="sourceLineNo">098</span><a name="line.98">        rooms.put("police office", police_office);</a>
<span class="sourceLineNo">099</span><a name="line.99">        rooms.put("back garden", back_garden);</a>
<span class="sourceLineNo">100</span><a name="line.100">        rooms.put("east corridor", east_corridor);</a>
<span class="sourceLineNo">101</span><a name="line.101">        rooms.put("chief office", chief_office);</a>
<span class="sourceLineNo">102</span><a name="line.102">        rooms.put("break room", break_room);</a>
<span class="sourceLineNo">103</span><a name="line.103">        rooms.put("roof", roof);</a>
<span class="sourceLineNo">104</span><a name="line.104">        rooms.put("backyard room", backyard_room);</a>
<span class="sourceLineNo">105</span><a name="line.105">        rooms.put("undergrounds", undergrounds);</a>
<span class="sourceLineNo">106</span><a name="line.106"></a>
<span class="sourceLineNo">107</span><a name="line.107">        // initialise room exits</a>
<span class="sourceLineNo">108</span><a name="line.108">        // start</a>
<span class="sourceLineNo">109</span><a name="line.109">        outside.setExit("north", station_hall);</a>
<span class="sourceLineNo">110</span><a name="line.110">        </a>
<span class="sourceLineNo">111</span><a name="line.111">        // Police station</a>
<span class="sourceLineNo">112</span><a name="line.112">        // Center</a>
<span class="sourceLineNo">113</span><a name="line.113">        station_hall.setExit("south", outside);</a>
<span class="sourceLineNo">114</span><a name="line.114">        station_hall.setExit("west", west_wing);</a>
<span class="sourceLineNo">115</span><a name="line.115">        station_hall.setExit("east", east_wing);</a>
<span class="sourceLineNo">116</span><a name="line.116">        station_hall.setExit("up", station_1st_floor);</a>
<span class="sourceLineNo">117</span><a name="line.117">        station_hall.setExit("down", undergrounds);</a>
<span class="sourceLineNo">118</span><a name="line.118">        </a>
<span class="sourceLineNo">119</span><a name="line.119">        station_1st_floor.setExit("west", library);</a>
<span class="sourceLineNo">120</span><a name="line.120">        station_1st_floor.setExit("east", chief_office);</a>
<span class="sourceLineNo">121</span><a name="line.121">        station_1st_floor.setExit("down", station_hall);</a>
<span class="sourceLineNo">122</span><a name="line.122">        </a>
<span class="sourceLineNo">123</span><a name="line.123">        // West side</a>
<span class="sourceLineNo">124</span><a name="line.124">        west_wing.setExit("east", station_hall);</a>
<span class="sourceLineNo">125</span><a name="line.125">        west_wing.setExit("west", armory);</a>
<span class="sourceLineNo">126</span><a name="line.126">        west_wing.setExit("north", west_stairs);</a>
<span class="sourceLineNo">127</span><a name="line.127">        </a>
<span class="sourceLineNo">128</span><a name="line.128">        armory.setExit("east", west_wing);</a>
<span class="sourceLineNo">129</span><a name="line.129">        </a>
<span class="sourceLineNo">130</span><a name="line.130">        west_stairs.setExit("south", west_wing);</a>
<span class="sourceLineNo">131</span><a name="line.131">        west_stairs.setExit("east", black_room);</a>
<span class="sourceLineNo">132</span><a name="line.132">        west_stairs.setExit("up", west_corridor);</a>
<span class="sourceLineNo">133</span><a name="line.133">        </a>
<span class="sourceLineNo">134</span><a name="line.134">        black_room.setExit("west", west_stairs);</a>
<span class="sourceLineNo">135</span><a name="line.135">        </a>
<span class="sourceLineNo">136</span><a name="line.136">        west_corridor.setExit("down", west_stairs);</a>
<span class="sourceLineNo">137</span><a name="line.137">        west_corridor.setExit("west", squad_office);</a>
<span class="sourceLineNo">138</span><a name="line.138">        west_corridor.setExit("east", reserve);</a>
<span class="sourceLineNo">139</span><a name="line.139">        </a>
<span class="sourceLineNo">140</span><a name="line.140">        squad_office.setExit("east", west_corridor);</a>
<span class="sourceLineNo">141</span><a name="line.141">        </a>
<span class="sourceLineNo">142</span><a name="line.142">        reserve.setExit("west", west_corridor);</a>
<span class="sourceLineNo">143</span><a name="line.143">        reserve.setExit("south", library);</a>
<span class="sourceLineNo">144</span><a name="line.144">        </a>
<span class="sourceLineNo">145</span><a name="line.145">        library.setExit("north", reserve);</a>
<span class="sourceLineNo">146</span><a name="line.146">        library.setExit("east", station_1st_floor);</a>
<span class="sourceLineNo">147</span><a name="line.147">        </a>
<span class="sourceLineNo">148</span><a name="line.148">        // East Side</a>
<span class="sourceLineNo">149</span><a name="line.149">        </a>
<span class="sourceLineNo">150</span><a name="line.150">        east_wing.setExit("east", back_garden);</a>
<span class="sourceLineNo">151</span><a name="line.151">        east_wing.setExit("west", station_hall);</a>
<span class="sourceLineNo">152</span><a name="line.152">        east_wing.setExit("north", bathroom);</a>
<span class="sourceLineNo">153</span><a name="line.153">        east_wing.setExit("south", police_office);</a>
<span class="sourceLineNo">154</span><a name="line.154">        </a>
<span class="sourceLineNo">155</span><a name="line.155">        bathroom.setExit("south", east_wing);</a>
<span class="sourceLineNo">156</span><a name="line.156">        </a>
<span class="sourceLineNo">157</span><a name="line.157">        police_office.setExit("north", east_wing);</a>
<span class="sourceLineNo">158</span><a name="line.158">        </a>
<span class="sourceLineNo">159</span><a name="line.159">        back_garden.setExit("west", east_wing);</a>
<span class="sourceLineNo">160</span><a name="line.160">        back_garden.setExit("up", east_corridor);</a>
<span class="sourceLineNo">161</span><a name="line.161">    </a>
<span class="sourceLineNo">162</span><a name="line.162">        east_corridor.setExit("down", back_garden);</a>
<span class="sourceLineNo">163</span><a name="line.163">        east_corridor.setExit("west", chief_office);</a>
<span class="sourceLineNo">164</span><a name="line.164">        east_corridor.setExit("east", roof);</a>
<span class="sourceLineNo">165</span><a name="line.165">        east_corridor.setExit("north", break_room);</a>
<span class="sourceLineNo">166</span><a name="line.166">        </a>
<span class="sourceLineNo">167</span><a name="line.167">        break_room.setExit("south", east_corridor);</a>
<span class="sourceLineNo">168</span><a name="line.168">        </a>
<span class="sourceLineNo">169</span><a name="line.169">        chief_office.setExit("east", east_corridor);</a>
<span class="sourceLineNo">170</span><a name="line.170">        chief_office.setExit("west", station_1st_floor);</a>
<span class="sourceLineNo">171</span><a name="line.171">        </a>
<span class="sourceLineNo">172</span><a name="line.172">        roof.setExit("west", east_corridor);</a>
<span class="sourceLineNo">173</span><a name="line.173">        roof.setExit("down", backyard_room);</a>
<span class="sourceLineNo">174</span><a name="line.174">        </a>
<span class="sourceLineNo">175</span><a name="line.175">        backyard_room.setExit("up", roof);</a>
<span class="sourceLineNo">176</span><a name="line.176">        </a>
<span class="sourceLineNo">177</span><a name="line.177">        //others</a>
<span class="sourceLineNo">178</span><a name="line.178">        undergrounds.setExit("up", station_hall);</a>
<span class="sourceLineNo">179</span><a name="line.179"></a>
<span class="sourceLineNo">180</span><a name="line.180">        </a>
<span class="sourceLineNo">181</span><a name="line.181">        // place objects in rooms</a>
<span class="sourceLineNo">182</span><a name="line.182">        station_hall.addItem(spray);</a>
<span class="sourceLineNo">183</span><a name="line.183">        armory.addItem(ammo);</a>
<span class="sourceLineNo">184</span><a name="line.184">        black_room.addItem(herb);</a>
<span class="sourceLineNo">185</span><a name="line.185">        squad_office.addItem(ammo);</a>
<span class="sourceLineNo">186</span><a name="line.186">        chief_office.addItem(ammo);</a>
<span class="sourceLineNo">187</span><a name="line.187">        police_office.addItem(ammo);</a>
<span class="sourceLineNo">188</span><a name="line.188">        bathroom.addItem(herb);</a>
<span class="sourceLineNo">189</span><a name="line.189">        break_room.addItem(herb);</a>
<span class="sourceLineNo">190</span><a name="line.190">        reserve.addItem(medal);</a>
<span class="sourceLineNo">191</span><a name="line.191">        backyard_room.addItem(medal);</a>
<span class="sourceLineNo">192</span><a name="line.192">        </a>
<span class="sourceLineNo">193</span><a name="line.193">        // place zombies in rooms</a>
<span class="sourceLineNo">194</span><a name="line.194">        outside.setZombiesInt(15);</a>
<span class="sourceLineNo">195</span><a name="line.195">        east_wing.setZombiesInt(3);</a>
<span class="sourceLineNo">196</span><a name="line.196">        west_wing.setZombiesInt(1);</a>
<span class="sourceLineNo">197</span><a name="line.197">        police_office.setZombiesInt(1);</a>
<span class="sourceLineNo">198</span><a name="line.198">        east_corridor.setZombiesInt(2);</a>
<span class="sourceLineNo">199</span><a name="line.199">        west_corridor.setZombiesInt(2);</a>
<span class="sourceLineNo">200</span><a name="line.200">        backyard_room.setZombiesInt(2);</a>
<span class="sourceLineNo">201</span><a name="line.201">        library.setZombiesInt(3);</a>
<span class="sourceLineNo">202</span><a name="line.202">        west_stairs.setZombiesInt(2);</a>
<span class="sourceLineNo">203</span><a name="line.203">        station_1st_floor.setZombiesInt(2);</a>
<span class="sourceLineNo">204</span><a name="line.204">        </a>
<span class="sourceLineNo">205</span><a name="line.205">        // lock directions</a>
<span class="sourceLineNo">206</span><a name="line.206">        station_hall.setState("down", true);</a>
<span class="sourceLineNo">207</span><a name="line.207">        library.setState("east", true);</a>
<span class="sourceLineNo">208</span><a name="line.208">        east_corridor.setState("west", true);</a>
<span class="sourceLineNo">209</span><a name="line.209">        </a>
<span class="sourceLineNo">210</span><a name="line.210">        // add an item requirement for unlocking</a>
<span class="sourceLineNo">211</span><a name="line.211">        station_hall.setItemNeeded("down", medal);</a>
<span class="sourceLineNo">212</span><a name="line.212">        </a>
<span class="sourceLineNo">213</span><a name="line.213">        medal.setRoom(station_hall); // set the use location for medal to station_hall</a>
<span class="sourceLineNo">214</span><a name="line.214">        medal.setNeeded(2); // set the number of medals needed to unlock</a>
<span class="sourceLineNo">215</span><a name="line.215">        medal.SetUseOn("down"); // set the direction the item can be used on</a>
<span class="sourceLineNo">216</span><a name="line.216">        </a>
<span class="sourceLineNo">217</span><a name="line.217">        currentRoom = outside;  // start game outside</a>
<span class="sourceLineNo">218</span><a name="line.218">        </a>
<span class="sourceLineNo">219</span><a name="line.219">    }</a>
<span class="sourceLineNo">220</span><a name="line.220"></a>
<span class="sourceLineNo">221</span><a name="line.221">    /**</a>
<span class="sourceLineNo">222</span><a name="line.222">     * Print out the opening message for the player.</a>
<span class="sourceLineNo">223</span><a name="line.223">     */</a>
<span class="sourceLineNo">224</span><a name="line.224">    private void printWelcome() {</a>
<span class="sourceLineNo">225</span><a name="line.225">        gui.println("");</a>
<span class="sourceLineNo">226</span><a name="line.226">        gui.println("Residu.. Evil (because of copyright)");</a>
<span class="sourceLineNo">227</span><a name="line.227">        gui.println("You are Leonn, a rookie police officer in Fock City");</a>
<span class="sourceLineNo">228</span><a name="line.228">        gui.println("Due to a virus, the city is now infested with yellow vests");</a>
<span class="sourceLineNo">229</span><a name="line.229">        gui.println("It's night-time and zombies are moving fast. You have to find a way out of this city");</a>
<span class="sourceLineNo">230</span><a name="line.230">        gui.println("Your only solution now is to take refuge in the police station");</a>
<span class="sourceLineNo">231</span><a name="line.231">        gui.println("Can you make it out alive?");</a>
<span class="sourceLineNo">232</span><a name="line.232">        gui.println("Type 'help' if you need help.");</a>
<span class="sourceLineNo">233</span><a name="line.233">        gui.println("");</a>
<span class="sourceLineNo">234</span><a name="line.234">        gui.showImage(currentRoom.getImageName());</a>
<span class="sourceLineNo">235</span><a name="line.235">        gui.println(currentRoom.getLongDescription());</a>
<span class="sourceLineNo">236</span><a name="line.236">        gui.println("");</a>
<span class="sourceLineNo">237</span><a name="line.237">    }</a>
<span class="sourceLineNo">238</span><a name="line.238">    </a>
<span class="sourceLineNo">239</span><a name="line.239">    public void interpretCommand(String commandLine) </a>
<span class="sourceLineNo">240</span><a name="line.240">    {</a>
<span class="sourceLineNo">241</span><a name="line.241">        gui.println(commandLine);</a>
<span class="sourceLineNo">242</span><a name="line.242">        Command command = parser.getCommand(commandLine);</a>
<span class="sourceLineNo">243</span><a name="line.243"></a>
<span class="sourceLineNo">244</span><a name="line.244">        if(command.isUnknown()) {</a>
<span class="sourceLineNo">245</span><a name="line.245">            gui.println("I don't know what you mean...");</a>
<span class="sourceLineNo">246</span><a name="line.246">            return;</a>
<span class="sourceLineNo">247</span><a name="line.247">        }</a>
<span class="sourceLineNo">248</span><a name="line.248"></a>
<span class="sourceLineNo">249</span><a name="line.249">        String commandWord = command.getCommandWord();</a>
<span class="sourceLineNo">250</span><a name="line.250">        if (commandWord.equals("help"))</a>
<span class="sourceLineNo">251</span><a name="line.251">                if(command.hasSecondWord())</a>
<span class="sourceLineNo">252</span><a name="line.252">                        gui.println("Just use help alone");</a>
<span class="sourceLineNo">253</span><a name="line.253">                else</a>
<span class="sourceLineNo">254</span><a name="line.254">                        printHelp();</a>
<span class="sourceLineNo">255</span><a name="line.255">        else if (commandWord.equals("go"))</a>
<span class="sourceLineNo">256</span><a name="line.256">            goRoom(command);</a>
<span class="sourceLineNo">257</span><a name="line.257">        else if (commandWord.equals("look"))</a>
<span class="sourceLineNo">258</span><a name="line.258">                gui.println(currentRoom.getLongDescription());</a>
<span class="sourceLineNo">259</span><a name="line.259">        else if (commandWord.equals("pickup"))</a>
<span class="sourceLineNo">260</span><a name="line.260">                pickup(command);</a>
<span class="sourceLineNo">261</span><a name="line.261">        else if (commandWord.equals("shoot"))</a>
<span class="sourceLineNo">262</span><a name="line.262">                shoot(command);</a>
<span class="sourceLineNo">263</span><a name="line.263">        else if (commandWord.equals("use"))</a>
<span class="sourceLineNo">264</span><a name="line.264">                use(command);</a>
<span class="sourceLineNo">265</span><a name="line.265">        else if (commandWord.equals("player"))</a>
<span class="sourceLineNo">266</span><a name="line.266">                if(command.hasSecondWord())</a>
<span class="sourceLineNo">267</span><a name="line.267">                        gui.println("Just use player alone");</a>
<span class="sourceLineNo">268</span><a name="line.268">                else</a>
<span class="sourceLineNo">269</span><a name="line.269">                        player();</a>
<span class="sourceLineNo">270</span><a name="line.270">        else if (commandWord.equals("unlock"))</a>
<span class="sourceLineNo">271</span><a name="line.271">                unlock(command);</a>
<span class="sourceLineNo">272</span><a name="line.272">        else if (commandWord.equals("reload"))</a>
<span class="sourceLineNo">273</span><a name="line.273">                if(command.hasSecondWord())</a>
<span class="sourceLineNo">274</span><a name="line.274">                        gui.println("Just use reload alone");</a>
<span class="sourceLineNo">275</span><a name="line.275">                else</a>
<span class="sourceLineNo">276</span><a name="line.276">                        reload();</a>
<span class="sourceLineNo">277</span><a name="line.277">        else if (commandWord.equals("info"))</a>
<span class="sourceLineNo">278</span><a name="line.278">           info(command);</a>
<span class="sourceLineNo">279</span><a name="line.279">        else if (commandWord.equals("back"))</a>
<span class="sourceLineNo">280</span><a name="line.280">                if(command.hasSecondWord())</a>
<span class="sourceLineNo">281</span><a name="line.281">                        gui.println("Just use back alone");</a>
<span class="sourceLineNo">282</span><a name="line.282">                else</a>
<span class="sourceLineNo">283</span><a name="line.283">                        back();</a>
<span class="sourceLineNo">284</span><a name="line.284">        else if (commandWord.equals("quit")) {</a>
<span class="sourceLineNo">285</span><a name="line.285">            if(command.hasSecondWord())</a>
<span class="sourceLineNo">286</span><a name="line.286">                gui.println("Quit what?");</a>
<span class="sourceLineNo">287</span><a name="line.287">            else</a>
<span class="sourceLineNo">288</span><a name="line.288">                endGame();</a>
<span class="sourceLineNo">289</span><a name="line.289">        }</a>
<span class="sourceLineNo">290</span><a name="line.290">        step(command);</a>
<span class="sourceLineNo">291</span><a name="line.291">        gui.println("");</a>
<span class="sourceLineNo">292</span><a name="line.292">    }</a>
<span class="sourceLineNo">293</span><a name="line.293">    </a>
<span class="sourceLineNo">294</span><a name="line.294">    //happens after a command</a>
<span class="sourceLineNo">295</span><a name="line.295">    //ends the game if you are dead</a>
<span class="sourceLineNo">296</span><a name="line.296">    //ends the game if you escaped</a>
<span class="sourceLineNo">297</span><a name="line.297">    private boolean step(Command command){</a>
<span class="sourceLineNo">298</span><a name="line.298">        </a>
<span class="sourceLineNo">299</span><a name="line.299">        if(command.isUnknown()) {</a>
<span class="sourceLineNo">300</span><a name="line.300">            return false;</a>
<span class="sourceLineNo">301</span><a name="line.301">        }</a>
<span class="sourceLineNo">302</span><a name="line.302">        if(command.getCommandWord().equals("reload")</a>
<span class="sourceLineNo">303</span><a name="line.303">                        || command.getCommandWord().equals("pickup")</a>
<span class="sourceLineNo">304</span><a name="line.304">                        || command.getCommandWord().equals("use")</a>
<span class="sourceLineNo">305</span><a name="line.305">                        || command.getCommandWord().equals("unlock")</a>
<span class="sourceLineNo">306</span><a name="line.306">                        || command.getCommandWord().equals("shoot")){</a>
<span class="sourceLineNo">307</span><a name="line.307">                if(!currentRoom.getZombies().isEmpty()){</a>
<span class="sourceLineNo">308</span><a name="line.308">                for(int i=0;i&lt;currentRoom.getZombies().size();i++){</a>
<span class="sourceLineNo">309</span><a name="line.309">                        gui.print("Zombie " + (i+1) + ": ");</a>
<span class="sourceLineNo">310</span><a name="line.310">                        gui.println(currentRoom.getZombies().get(i).attack(player));            </a>
<span class="sourceLineNo">311</span><a name="line.311">                }</a>
<span class="sourceLineNo">312</span><a name="line.312">                gui.println("Your health: " + player.getHealth());</a>
<span class="sourceLineNo">313</span><a name="line.313">            }</a>
<span class="sourceLineNo">314</span><a name="line.314">                if(player.getHealth()&lt;=0){</a>
<span class="sourceLineNo">315</span><a name="line.315">                        gui.println("You are dead!");</a>
<span class="sourceLineNo">316</span><a name="line.316">                        return true;</a>
<span class="sourceLineNo">317</span><a name="line.317">                }</a>
<span class="sourceLineNo">318</span><a name="line.318">        }</a>
<span class="sourceLineNo">319</span><a name="line.319">        if(currentRoom.equals(rooms.get("undergrounds"))) {</a>
<span class="sourceLineNo">320</span><a name="line.320">                return true;</a>
<span class="sourceLineNo">321</span><a name="line.321">        }</a>
<span class="sourceLineNo">322</span><a name="line.322">        return false;</a>
<span class="sourceLineNo">323</span><a name="line.323">    }</a>
<span class="sourceLineNo">324</span><a name="line.324">    </a>
<span class="sourceLineNo">325</span><a name="line.325">    // implementations of user commands:</a>
<span class="sourceLineNo">326</span><a name="line.326">    </a>
<span class="sourceLineNo">327</span><a name="line.327">    /**</a>
<span class="sourceLineNo">328</span><a name="line.328">     * Print out some help information.</a>
<span class="sourceLineNo">329</span><a name="line.329">     */</a>
<span class="sourceLineNo">330</span><a name="line.330">    private void printHelp() {</a>
<span class="sourceLineNo">331</span><a name="line.331">        gui.println("Your command words are:");</a>
<span class="sourceLineNo">332</span><a name="line.332">        parser.showCommands();</a>
<span class="sourceLineNo">333</span><a name="line.333">        gui.print("\n");</a>
<span class="sourceLineNo">334</span><a name="line.334">        gui.println("go *direction* = move to next location");</a>
<span class="sourceLineNo">335</span><a name="line.335">        gui.println("quit = stop the game");</a>
<span class="sourceLineNo">336</span><a name="line.336">        gui.println("shoot *ZombieNumber* (ex: 2 zombies, 'shoot 1' means shoot on the zombie number 1) = fire on a zombie");</a>
<span class="sourceLineNo">337</span><a name="line.337">        gui.println("look = returns the description of the current room");</a>
<span class="sourceLineNo">338</span><a name="line.338">        gui.println("pickup *ItemName* = get in your inventory the named item");</a>
<span class="sourceLineNo">339</span><a name="line.339">        gui.println("player = shows your stats");</a>
<span class="sourceLineNo">340</span><a name="line.340">        gui.println("unlock *direction* = unlocking a path");</a>
<span class="sourceLineNo">341</span><a name="line.341">        gui.println("reload = reload your current weapon");</a>
<span class="sourceLineNo">342</span><a name="line.342">        gui.println("info *itemName* = display the description of the named item");</a>
<span class="sourceLineNo">343</span><a name="line.343">        gui.println("back = return on the previous room");</a>
<span class="sourceLineNo">344</span><a name="line.344">    }</a>
<span class="sourceLineNo">345</span><a name="line.345"></a>
<span class="sourceLineNo">346</span><a name="line.346">    /**</a>
<span class="sourceLineNo">347</span><a name="line.347">     * Try to go to one direction. If there is an exit, enter</a>
<span class="sourceLineNo">348</span><a name="line.348">     * the new room, otherwise print an error message.</a>
<span class="sourceLineNo">349</span><a name="line.349">     */</a>
<span class="sourceLineNo">350</span><a name="line.350">    private void goRoom(Command command) {</a>
<span class="sourceLineNo">351</span><a name="line.351">        if(!command.hasSecondWord()) {</a>
<span class="sourceLineNo">352</span><a name="line.352">            // if there is no second word, we don't know where to go...</a>
<span class="sourceLineNo">353</span><a name="line.353">            gui.println("Go where?");</a>
<span class="sourceLineNo">354</span><a name="line.354">            return;</a>
<span class="sourceLineNo">355</span><a name="line.355">        }</a>
<span class="sourceLineNo">356</span><a name="line.356">        </a>
<span class="sourceLineNo">357</span><a name="line.357">        String direction = command.getSecondWord();</a>
<span class="sourceLineNo">358</span><a name="line.358">        </a>
<span class="sourceLineNo">359</span><a name="line.359">        // Try to leave current room.</a>
<span class="sourceLineNo">360</span><a name="line.360">        Room nextRoom = currentRoom.getExit(direction);</a>
<span class="sourceLineNo">361</span><a name="line.361">        </a>
<span class="sourceLineNo">362</span><a name="line.362">        if (nextRoom == null) {</a>
<span class="sourceLineNo">363</span><a name="line.363">            gui.println("There is no door!");</a>
<span class="sourceLineNo">364</span><a name="line.364">            return;</a>
<span class="sourceLineNo">365</span><a name="line.365">        }</a>
<span class="sourceLineNo">366</span><a name="line.366">        </a>
<span class="sourceLineNo">367</span><a name="line.367">        // verifie que le passage n'est pas ferme</a>
<span class="sourceLineNo">368</span><a name="line.368">        else if(!currentRoom.getStates().isEmpty() &amp;&amp; currentRoom.getStates().containsKey(direction)){</a>
<span class="sourceLineNo">369</span><a name="line.369">                if(currentRoom.getState(direction)==true) {</a>
<span class="sourceLineNo">370</span><a name="line.370">                        gui.println("This access is locked");</a>
<span class="sourceLineNo">371</span><a name="line.371">                        return;</a>
<span class="sourceLineNo">372</span><a name="line.372">                }       </a>
<span class="sourceLineNo">373</span><a name="line.373">        }</a>
<span class="sourceLineNo">374</span><a name="line.374">                </a>
<span class="sourceLineNo">375</span><a name="line.375">        // verifie que l'acces n'est pas bloque depuis l'autre piece</a>
<span class="sourceLineNo">376</span><a name="line.376">        else if(!nextRoom.getStates().isEmpty()){</a>
<span class="sourceLineNo">377</span><a name="line.377">                String opposite = nextRoom.getOpposite(direction);</a>
<span class="sourceLineNo">378</span><a name="line.378">            if(nextRoom.getStates().containsKey(opposite)) {            </a>
<span class="sourceLineNo">379</span><a name="line.379">                if(nextRoom.getState(opposite)==true) {</a>
<span class="sourceLineNo">380</span><a name="line.380">                        gui.println("This access is locked from the other side");</a>
<span class="sourceLineNo">381</span><a name="line.381">                        return;</a>
<span class="sourceLineNo">382</span><a name="line.382">                }</a>
<span class="sourceLineNo">383</span><a name="line.383">            }</a>
<span class="sourceLineNo">384</span><a name="line.384">        }       </a>
<span class="sourceLineNo">385</span><a name="line.385">        </a>
<span class="sourceLineNo">386</span><a name="line.386">        if(!currentRoom.equals(rooms.get("outside"))) {</a>
<span class="sourceLineNo">387</span><a name="line.387">                if(!currentRoom.getZombies().isEmpty()){</a>
<span class="sourceLineNo">388</span><a name="line.388">                        Random rand = new Random();</a>
<span class="sourceLineNo">389</span><a name="line.389">                if(rand.nextInt(10) &gt;= 7) {</a>
<span class="sourceLineNo">390</span><a name="line.390">                        player.isAttacked();</a>
<span class="sourceLineNo">391</span><a name="line.391">                        gui.println("A zombie bite you while you were escaping!");</a>
<span class="sourceLineNo">392</span><a name="line.392">                }</a>
<span class="sourceLineNo">393</span><a name="line.393">                else {</a>
<span class="sourceLineNo">394</span><a name="line.394">                        gui.println("You managed to flee without getting hurt");</a>
<span class="sourceLineNo">395</span><a name="line.395">                }</a>
<span class="sourceLineNo">396</span><a name="line.396">                gui.println("Your health: " + player.getHealth());              </a>
<span class="sourceLineNo">397</span><a name="line.397">                }</a>
<span class="sourceLineNo">398</span><a name="line.398">        }</a>
<span class="sourceLineNo">399</span><a name="line.399">        </a>
<span class="sourceLineNo">400</span><a name="line.400">        roadHistory.push(currentRoom);</a>
<span class="sourceLineNo">401</span><a name="line.401">        currentRoom = nextRoom;</a>
<span class="sourceLineNo">402</span><a name="line.402">        gui.println(currentRoom.getLongDescription());</a>
<span class="sourceLineNo">403</span><a name="line.403">        if(currentRoom.getImageName() != null)</a>
<span class="sourceLineNo">404</span><a name="line.404">            gui.showImage(currentRoom.getImageName());</a>
<span class="sourceLineNo">405</span><a name="line.405">    }</a>
<span class="sourceLineNo">406</span><a name="line.406">    </a>
<span class="sourceLineNo">407</span><a name="line.407">    </a>
<span class="sourceLineNo">408</span><a name="line.408">    //affiche les informations du joueur</a>
<span class="sourceLineNo">409</span><a name="line.409">    private void player(){</a>
<span class="sourceLineNo">410</span><a name="line.410">        gui.println("Your current health: " + player.getHealth());</a>
<span class="sourceLineNo">411</span><a name="line.411">        gui.println("Ammo in weapon: " + player.getGun().getAmmo());</a>
<span class="sourceLineNo">412</span><a name="line.412">        gui.print("Your items: ");</a>
<span class="sourceLineNo">413</span><a name="line.413">        for(int i=0;i&lt;player.getItems().size();i++) {</a>
<span class="sourceLineNo">414</span><a name="line.414">                gui.print(player.getItems().get(i).getName() + " x" + player.getItems().get(i).getNumber() + " ");</a>
<span class="sourceLineNo">415</span><a name="line.415">        }</a>
<span class="sourceLineNo">416</span><a name="line.416">        gui.println("");</a>
<span class="sourceLineNo">417</span><a name="line.417">    }</a>
<span class="sourceLineNo">418</span><a name="line.418">    </a>
<span class="sourceLineNo">419</span><a name="line.419">    </a>
<span class="sourceLineNo">420</span><a name="line.420">    //recharge l'arme</a>
<span class="sourceLineNo">421</span><a name="line.421">    private void reload() {</a>
<span class="sourceLineNo">422</span><a name="line.422">        if(!player.getItems().contains(ammo)) {</a>
<span class="sourceLineNo">423</span><a name="line.423">                gui.println("You don't have any ammo in your inventory dude \n");</a>
<span class="sourceLineNo">424</span><a name="line.424">            return;</a>
<span class="sourceLineNo">425</span><a name="line.425">        }</a>
<span class="sourceLineNo">426</span><a name="line.426">        </a>
<span class="sourceLineNo">427</span><a name="line.427">        if(player.getGun().getAmmo() == player.getGun().max_ammo) {</a>
<span class="sourceLineNo">428</span><a name="line.428">                gui.println("Your weapon is fully charged already! \n");</a>
<span class="sourceLineNo">429</span><a name="line.429">            return;</a>
<span class="sourceLineNo">430</span><a name="line.430">        }</a>
<span class="sourceLineNo">431</span><a name="line.431">        </a>
<span class="sourceLineNo">432</span><a name="line.432">        int pos = player.getItems().lastIndexOf(ammo);</a>
<span class="sourceLineNo">433</span><a name="line.433">        int ammo_needed = player.getGun().max_ammo - player.getGun().getAmmo();</a>
<span class="sourceLineNo">434</span><a name="line.434">        int ammo_available = player.getItems().get(pos).getNumber();</a>
<span class="sourceLineNo">435</span><a name="line.435">        </a>
<span class="sourceLineNo">436</span><a name="line.436">        gui.println("You reload your weapon");</a>
<span class="sourceLineNo">437</span><a name="line.437">        </a>
<span class="sourceLineNo">438</span><a name="line.438">        if(ammo_needed &gt; ammo_available) {</a>
<span class="sourceLineNo">439</span><a name="line.439">                player.getGun().setAmmo(player.getGun().getAmmo() + ammo_available);</a>
<span class="sourceLineNo">440</span><a name="line.440">        }</a>
<span class="sourceLineNo">441</span><a name="line.441">        else {</a>
<span class="sourceLineNo">442</span><a name="line.442">                player.getGun().setAmmo(player.getGun().getAmmo() + ammo_needed);</a>
<span class="sourceLineNo">443</span><a name="line.443">                player.getItems().get(pos).setNumber(player.getItems().get(pos).getNumber() - ammo_needed);</a>
<span class="sourceLineNo">444</span><a name="line.444">                gui.println("Weapon fully reloaded. Ammo in weapon: " + player.getGun().getAmmo());</a>
<span class="sourceLineNo">445</span><a name="line.445">        }</a>
<span class="sourceLineNo">446</span><a name="line.446">        </a>
<span class="sourceLineNo">447</span><a name="line.447">        if(player.getItems().get(pos).getNumber() == 0) {</a>
<span class="sourceLineNo">448</span><a name="line.448">                player.getItems().remove(pos);</a>
<span class="sourceLineNo">449</span><a name="line.449">        }</a>
<span class="sourceLineNo">450</span><a name="line.450">        </a>
<span class="sourceLineNo">451</span><a name="line.451">        return;</a>
<span class="sourceLineNo">452</span><a name="line.452">    } </a>
<span class="sourceLineNo">453</span><a name="line.453">    </a>
<span class="sourceLineNo">454</span><a name="line.454">    //cible et tire sur un ennemi</a>
<span class="sourceLineNo">455</span><a name="line.455">    private void shoot (Command command){</a>
<span class="sourceLineNo">456</span><a name="line.456">        if(player.getGun().getAmmo() == 0) {</a>
<span class="sourceLineNo">457</span><a name="line.457">                gui.println("No more ammo!");</a>
<span class="sourceLineNo">458</span><a name="line.458">                gui.println("The zombies are coming closer! RUN!!");</a>
<span class="sourceLineNo">459</span><a name="line.459">                return;</a>
<span class="sourceLineNo">460</span><a name="line.460">        }</a>
<span class="sourceLineNo">461</span><a name="line.461">        </a>
<span class="sourceLineNo">462</span><a name="line.462">        if(!command.hasSecondWord()) {</a>
<span class="sourceLineNo">463</span><a name="line.463">            gui.println("Shoot who?");</a>
<span class="sourceLineNo">464</span><a name="line.464">            return;</a>
<span class="sourceLineNo">465</span><a name="line.465">        }</a>
<span class="sourceLineNo">466</span><a name="line.466">        </a>
<span class="sourceLineNo">467</span><a name="line.467">        if(currentRoom.getZombies().isEmpty()) {</a>
<span class="sourceLineNo">468</span><a name="line.468">                gui.println("No zombies here!");</a>
<span class="sourceLineNo">469</span><a name="line.469">                return;</a>
<span class="sourceLineNo">470</span><a name="line.470">        }</a>
<span class="sourceLineNo">471</span><a name="line.471">        </a>
<span class="sourceLineNo">472</span><a name="line.472">        int zombie_number =  Integer.parseInt(command.getSecondWord());</a>
<span class="sourceLineNo">473</span><a name="line.473">        if(zombie_number &gt; currentRoom.getZombies().size()) {</a>
<span class="sourceLineNo">474</span><a name="line.474">                gui.println("Not that much zombies here! What are you aiming at?");</a>
<span class="sourceLineNo">475</span><a name="line.475">                return;</a>
<span class="sourceLineNo">476</span><a name="line.476">        }</a>
<span class="sourceLineNo">477</span><a name="line.477">        Zombie zombie = currentRoom.getZombies().get(zombie_number -1);</a>
<span class="sourceLineNo">478</span><a name="line.478">        Random rand = new Random();</a>
<span class="sourceLineNo">479</span><a name="line.479">        </a>
<span class="sourceLineNo">480</span><a name="line.480">        if(rand.nextInt(10) &gt;= 6) {</a>
<span class="sourceLineNo">481</span><a name="line.481">                zombie.setAggro(zombie.getAggro() - 50);</a>
<span class="sourceLineNo">482</span><a name="line.482">                if(zombie.getAggro() &lt; 0)</a>
<span class="sourceLineNo">483</span><a name="line.483">                        zombie.setAggro(0);</a>
<span class="sourceLineNo">484</span><a name="line.484">                gui.println("Zombie " + zombie_number + " flinched!");</a>
<span class="sourceLineNo">485</span><a name="line.485">        }</a>
<span class="sourceLineNo">486</span><a name="line.486">        </a>
<span class="sourceLineNo">487</span><a name="line.487">        zombie.setHealth(zombie.getHealth()-1);</a>
<span class="sourceLineNo">488</span><a name="line.488">        player.getGun().setAmmo(player.getGun().getAmmo() -1);</a>
<span class="sourceLineNo">489</span><a name="line.489">        </a>
<span class="sourceLineNo">490</span><a name="line.490">        gui.println("Ammo left in gun: " + player.getGun().getAmmo());</a>
<span class="sourceLineNo">491</span><a name="line.491">        gui.println("Zombie " + zombie_number + " has " + zombie.getHealth() + " hp left !");</a>
<span class="sourceLineNo">492</span><a name="line.492">        </a>
<span class="sourceLineNo">493</span><a name="line.493">        if(zombie.getHealth() == 0) {</a>
<span class="sourceLineNo">494</span><a name="line.494">                gui.println("Zombie " + zombie_number + " is dead !");</a>
<span class="sourceLineNo">495</span><a name="line.495">                ArrayList&lt;Zombie&gt; zombies = currentRoom.getZombies();</a>
<span class="sourceLineNo">496</span><a name="line.496">                zombies.remove(zombie_number -1);</a>
<span class="sourceLineNo">497</span><a name="line.497">                currentRoom.setZombies(zombies);</a>
<span class="sourceLineNo">498</span><a name="line.498">        }</a>
<span class="sourceLineNo">499</span><a name="line.499">        </a>
<span class="sourceLineNo">500</span><a name="line.500">    }</a>
<span class="sourceLineNo">501</span><a name="line.501">    </a>
<span class="sourceLineNo">502</span><a name="line.502">    //utilise un objet</a>
<span class="sourceLineNo">503</span><a name="line.503">    private void use(Command command) {</a>
<span class="sourceLineNo">504</span><a name="line.504">        </a>
<span class="sourceLineNo">505</span><a name="line.505">        if(!command.hasSecondWord()) {</a>
<span class="sourceLineNo">506</span><a name="line.506">            gui.println("Use what?");</a>
<span class="sourceLineNo">507</span><a name="line.507">            return;</a>
<span class="sourceLineNo">508</span><a name="line.508">        }</a>
<span class="sourceLineNo">509</span><a name="line.509">        </a>
<span class="sourceLineNo">510</span><a name="line.510">        switch(command.getSecondWord()){</a>
<span class="sourceLineNo">511</span><a name="line.511">        </a>
<span class="sourceLineNo">512</span><a name="line.512">                case "herb":</a>
<span class="sourceLineNo">513</span><a name="line.513">                        useHeal(herb);</a>
<span class="sourceLineNo">514</span><a name="line.514">                        break;</a>
<span class="sourceLineNo">515</span><a name="line.515">                        </a>
<span class="sourceLineNo">516</span><a name="line.516">                case "spray":</a>
<span class="sourceLineNo">517</span><a name="line.517">                        useHeal(spray);</a>
<span class="sourceLineNo">518</span><a name="line.518">                        break;</a>
<span class="sourceLineNo">519</span><a name="line.519">                        </a>
<span class="sourceLineNo">520</span><a name="line.520">                case "medal":</a>
<span class="sourceLineNo">521</span><a name="line.521">                        useKey(medal);</a>
<span class="sourceLineNo">522</span><a name="line.522">                        break;</a>
<span class="sourceLineNo">523</span><a name="line.523">                </a>
<span class="sourceLineNo">524</span><a name="line.524">                default:</a>
<span class="sourceLineNo">525</span><a name="line.525">                        gui.println("What is that?");</a>
<span class="sourceLineNo">526</span><a name="line.526">                        break;</a>
<span class="sourceLineNo">527</span><a name="line.527">        }</a>
<span class="sourceLineNo">528</span><a name="line.528">        </a>
<span class="sourceLineNo">529</span><a name="line.529">    }</a>
<span class="sourceLineNo">530</span><a name="line.530">    </a>
<span class="sourceLineNo">531</span><a name="line.531">    </a>
<span class="sourceLineNo">532</span><a name="line.532">    private void useHeal(HealItem item){</a>
<span class="sourceLineNo">533</span><a name="line.533">        </a>
<span class="sourceLineNo">534</span><a name="line.534">        if(!player.getItems().contains(item)) {</a>
<span class="sourceLineNo">535</span><a name="line.535">                        gui.println("You don't have any " + item.getName());</a>
<span class="sourceLineNo">536</span><a name="line.536">            return;</a>
<span class="sourceLineNo">537</span><a name="line.537">                }</a>
<span class="sourceLineNo">538</span><a name="line.538">                </a>
<span class="sourceLineNo">539</span><a name="line.539">                if(player.getHealth() == player.max_health) {</a>
<span class="sourceLineNo">540</span><a name="line.540">                        gui.println("You are full health already.");</a>
<span class="sourceLineNo">541</span><a name="line.541">                        gui.println("Your current health: " + player.getHealth());</a>
<span class="sourceLineNo">542</span><a name="line.542">            return;</a>
<span class="sourceLineNo">543</span><a name="line.543">                }</a>
<span class="sourceLineNo">544</span><a name="line.544">                </a>
<span class="sourceLineNo">545</span><a name="line.545">                player.setHealth(player.getHealth() + item.getHealing());</a>
<span class="sourceLineNo">546</span><a name="line.546">                if(player.getHealth()&gt;player.max_health)</a>
<span class="sourceLineNo">547</span><a name="line.547">                        player.setHealth(player.max_health);</a>
<span class="sourceLineNo">548</span><a name="line.548">                </a>
<span class="sourceLineNo">549</span><a name="line.549">                player.removeItem(item);</a>
<span class="sourceLineNo">550</span><a name="line.550">                </a>
<span class="sourceLineNo">551</span><a name="line.551">                gui.println("You used a " + item.getName());</a>
<span class="sourceLineNo">552</span><a name="line.552">                gui.println("Your current health: " + player.getHealth());</a>
<span class="sourceLineNo">553</span><a name="line.553">                return;</a>
<span class="sourceLineNo">554</span><a name="line.554">    }</a>
<span class="sourceLineNo">555</span><a name="line.555">    </a>
<span class="sourceLineNo">556</span><a name="line.556">    </a>
<span class="sourceLineNo">557</span><a name="line.557">    private void useKey(KeyItem item){</a>
<span class="sourceLineNo">558</span><a name="line.558">        </a>
<span class="sourceLineNo">559</span><a name="line.559">        if(!player.getItems().contains(item)) {</a>
<span class="sourceLineNo">560</span><a name="line.560">                        gui.println("You don't have any " + item.getName());</a>
<span class="sourceLineNo">561</span><a name="line.561">            return;</a>
<span class="sourceLineNo">562</span><a name="line.562">                }</a>
<span class="sourceLineNo">563</span><a name="line.563">                </a>
<span class="sourceLineNo">564</span><a name="line.564">                if(!currentRoom.equals(item.getRoom())){</a>
<span class="sourceLineNo">565</span><a name="line.565">                        gui.println("You can't use this here");</a>
<span class="sourceLineNo">566</span><a name="line.566">            return;</a>
<span class="sourceLineNo">567</span><a name="line.567">                }</a>
<span class="sourceLineNo">568</span><a name="line.568">                </a>
<span class="sourceLineNo">569</span><a name="line.569">                player.removeItem(item);</a>
<span class="sourceLineNo">570</span><a name="line.570">                </a>
<span class="sourceLineNo">571</span><a name="line.571">                gui.println("You used " + item.getName());</a>
<span class="sourceLineNo">572</span><a name="line.572">                </a>
<span class="sourceLineNo">573</span><a name="line.573">                item.setNeeded(item.getNeeded() -1);</a>
<span class="sourceLineNo">574</span><a name="line.574">                if(item.getNeeded() == 0){</a>
<span class="sourceLineNo">575</span><a name="line.575">                        currentRoom.setState(item.getUseOn(), false);</a>
<span class="sourceLineNo">576</span><a name="line.576">                        currentRoom.setItemNeeded(item.getUseOn(), null);</a>
<span class="sourceLineNo">577</span><a name="line.577">                        gui.println("You've unlocked the " + item.getUseOn() + " access");</a>
<span class="sourceLineNo">578</span><a name="line.578">                }</a>
<span class="sourceLineNo">579</span><a name="line.579">                else {</a>
<span class="sourceLineNo">580</span><a name="line.580">                        gui.println("You need " + item.getNeeded() + " more");</a>
<span class="sourceLineNo">581</span><a name="line.581">                }</a>
<span class="sourceLineNo">582</span><a name="line.582">    }</a>
<span class="sourceLineNo">583</span><a name="line.583"></a>
<span class="sourceLineNo">584</span><a name="line.584">    </a>
<span class="sourceLineNo">585</span><a name="line.585">    </a>
<span class="sourceLineNo">586</span><a name="line.586">    private void pickup(Command command){</a>
<span class="sourceLineNo">587</span><a name="line.587">        </a>
<span class="sourceLineNo">588</span><a name="line.588">        if(currentRoom.getItems().isEmpty())    </a>
<span class="sourceLineNo">589</span><a name="line.589">                gui.println("There is no item here !");</a>
<span class="sourceLineNo">590</span><a name="line.590">        </a>
<span class="sourceLineNo">591</span><a name="line.591">        else if(!command.hasSecondWord()) {</a>
<span class="sourceLineNo">592</span><a name="line.592">                gui.println("Pickup what?");</a>
<span class="sourceLineNo">593</span><a name="line.593">        }</a>
<span class="sourceLineNo">594</span><a name="line.594">        </a>
<span class="sourceLineNo">595</span><a name="line.595">        else if(currentRoom.haveItemName(command.getSecondWord())){</a>
<span class="sourceLineNo">596</span><a name="line.596">                </a>
<span class="sourceLineNo">597</span><a name="line.597">                Item item = Item.findByName(command.getSecondWord(), currentRoom.getItems());</a>
<span class="sourceLineNo">598</span><a name="line.598">                gui.println("You picked up " + item.getName());</a>
<span class="sourceLineNo">599</span><a name="line.599">                </a>
<span class="sourceLineNo">600</span><a name="line.600">                if(!player.getItems().contains(item)) {</a>
<span class="sourceLineNo">601</span><a name="line.601">                        player.getItems().add(item);</a>
<span class="sourceLineNo">602</span><a name="line.602">                }</a>
<span class="sourceLineNo">603</span><a name="line.603">                </a>
<span class="sourceLineNo">604</span><a name="line.604">                else {</a>
<span class="sourceLineNo">605</span><a name="line.605">                        int pos = player.getItems().lastIndexOf(item);</a>
<span class="sourceLineNo">606</span><a name="line.606">                        player.getItems().get(pos).setNumber(player.getItems().get(pos).getNumber() + item.initial_number);</a>
<span class="sourceLineNo">607</span><a name="line.607">                }</a>
<span class="sourceLineNo">608</span><a name="line.608">                </a>
<span class="sourceLineNo">609</span><a name="line.609">                currentRoom.removeItem(item);</a>
<span class="sourceLineNo">610</span><a name="line.610">        }       </a>
<span class="sourceLineNo">611</span><a name="line.611">        </a>
<span class="sourceLineNo">612</span><a name="line.612">    }</a>
<span class="sourceLineNo">613</span><a name="line.613">    </a>
<span class="sourceLineNo">614</span><a name="line.614">    private void unlock(Command command) {</a>
<span class="sourceLineNo">615</span><a name="line.615">        </a>
<span class="sourceLineNo">616</span><a name="line.616">        if(currentRoom.getStates().isEmpty()) {</a>
<span class="sourceLineNo">617</span><a name="line.617">                gui.println("There's nothing to unlock in this direction");</a>
<span class="sourceLineNo">618</span><a name="line.618">        }</a>
<span class="sourceLineNo">619</span><a name="line.619">        </a>
<span class="sourceLineNo">620</span><a name="line.620">        else if(!command.hasSecondWord()) {</a>
<span class="sourceLineNo">621</span><a name="line.621">            gui.println("Unlock what?");</a>
<span class="sourceLineNo">622</span><a name="line.622">        }</a>
<span class="sourceLineNo">623</span><a name="line.623">        </a>
<span class="sourceLineNo">624</span><a name="line.624">        else if(currentRoom.getState(command.getSecondWord()) == false) {</a>
<span class="sourceLineNo">625</span><a name="line.625">                gui.println("This access is already unlocked");</a>
<span class="sourceLineNo">626</span><a name="line.626">        }</a>
<span class="sourceLineNo">627</span><a name="line.627">        </a>
<span class="sourceLineNo">628</span><a name="line.628">        else if(currentRoom.getItemNeeded(command.getSecondWord()) != null) {</a>
<span class="sourceLineNo">629</span><a name="line.629">                gui.println("You need to use an specific item first");</a>
<span class="sourceLineNo">630</span><a name="line.630">        }</a>
<span class="sourceLineNo">631</span><a name="line.631">        </a>
<span class="sourceLineNo">632</span><a name="line.632">        else {</a>
<span class="sourceLineNo">633</span><a name="line.633">                currentRoom.setState(command.getSecondWord(), false);</a>
<span class="sourceLineNo">634</span><a name="line.634">                gui.println("You've unlocked the " + command.getSecondWord() + " access");</a>
<span class="sourceLineNo">635</span><a name="line.635">        }</a>
<span class="sourceLineNo">636</span><a name="line.636">        </a>
<span class="sourceLineNo">637</span><a name="line.637">    }</a>
<span class="sourceLineNo">638</span><a name="line.638">    </a>
<span class="sourceLineNo">639</span><a name="line.639">    private void info(Command command) {</a>
<span class="sourceLineNo">640</span><a name="line.640">        </a>
<span class="sourceLineNo">641</span><a name="line.641">        if(!command.hasSecondWord()) {</a>
<span class="sourceLineNo">642</span><a name="line.642">            gui.println("Info on what?");</a>
<span class="sourceLineNo">643</span><a name="line.643">        }</a>
<span class="sourceLineNo">644</span><a name="line.644">        </a>
<span class="sourceLineNo">645</span><a name="line.645">        else {</a>
<span class="sourceLineNo">646</span><a name="line.646">                switch(command.getSecondWord()){</a>
<span class="sourceLineNo">647</span><a name="line.647">                </a>
<span class="sourceLineNo">648</span><a name="line.648">                        case "herb":</a>
<span class="sourceLineNo">649</span><a name="line.649">                                gui.println(herb.getDescription());</a>
<span class="sourceLineNo">650</span><a name="line.650">                                break;</a>
<span class="sourceLineNo">651</span><a name="line.651">                        </a>
<span class="sourceLineNo">652</span><a name="line.652">                        case "spray":</a>
<span class="sourceLineNo">653</span><a name="line.653">                                gui.println(spray.getDescription());</a>
<span class="sourceLineNo">654</span><a name="line.654">                                break;</a>
<span class="sourceLineNo">655</span><a name="line.655">                        </a>
<span class="sourceLineNo">656</span><a name="line.656">                        case "medal":</a>
<span class="sourceLineNo">657</span><a name="line.657">                                gui.println(medal.getDescription());</a>
<span class="sourceLineNo">658</span><a name="line.658">                                break;</a>
<span class="sourceLineNo">659</span><a name="line.659">                        </a>
<span class="sourceLineNo">660</span><a name="line.660">                        case "ammo":</a>
<span class="sourceLineNo">661</span><a name="line.661">                                gui.println(ammo.getDescription());</a>
<span class="sourceLineNo">662</span><a name="line.662">                                break;</a>
<span class="sourceLineNo">663</span><a name="line.663">                </a>
<span class="sourceLineNo">664</span><a name="line.664">                        default:</a>
<span class="sourceLineNo">665</span><a name="line.665">                                gui.println("What is that?");</a>
<span class="sourceLineNo">666</span><a name="line.666">                                break;</a>
<span class="sourceLineNo">667</span><a name="line.667">                }</a>
<span class="sourceLineNo">668</span><a name="line.668">        }</a>
<span class="sourceLineNo">669</span><a name="line.669">    }</a>
<span class="sourceLineNo">670</span><a name="line.670">    </a>
<span class="sourceLineNo">671</span><a name="line.671">    private void back() {</a>
<span class="sourceLineNo">672</span><a name="line.672">        </a>
<span class="sourceLineNo">673</span><a name="line.673">        try {</a>
<span class="sourceLineNo">674</span><a name="line.674">                        currentRoom =roadHistory.pop();</a>
<span class="sourceLineNo">675</span><a name="line.675">                        gui.println(currentRoom.getLongDescription());</a>
<span class="sourceLineNo">676</span><a name="line.676">                if(currentRoom.getImageName() != null)</a>
<span class="sourceLineNo">677</span><a name="line.677">                    gui.showImage(currentRoom.getImageName());</a>
<span class="sourceLineNo">678</span><a name="line.678">                </a>
<span class="sourceLineNo">679</span><a name="line.679">                } catch (Exception e) {</a>
<span class="sourceLineNo">680</span><a name="line.680">                        gui.println("You can't go back any further");</a>
<span class="sourceLineNo">681</span><a name="line.681">                }</a>
<span class="sourceLineNo">682</span><a name="line.682">    }</a>
<span class="sourceLineNo">683</span><a name="line.683"></a>
<span class="sourceLineNo">684</span><a name="line.684">    /**</a>
<span class="sourceLineNo">685</span><a name="line.685">     * "Quit" was entered. Check the rest of the command to see</a>
<span class="sourceLineNo">686</span><a name="line.686">     * whether we really quit the game.</a>
<span class="sourceLineNo">687</span><a name="line.687">     * @return true, if this command quits the game, false otherwise.</a>
<span class="sourceLineNo">688</span><a name="line.688">     */</a>
<span class="sourceLineNo">689</span><a name="line.689">    </a>
<span class="sourceLineNo">690</span><a name="line.690">    private void endGame()</a>
<span class="sourceLineNo">691</span><a name="line.691">    {</a>
<span class="sourceLineNo">692</span><a name="line.692">        gui.println("Thank you for playing.  Good bye.");</a>
<span class="sourceLineNo">693</span><a name="line.693">        gui.enable(false);</a>
<span class="sourceLineNo">694</span><a name="line.694">    }</a>
<span class="sourceLineNo">695</span><a name="line.695">}</a>




























































</pre>
</div>
</body>
</html>
